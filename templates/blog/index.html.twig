{% extends 'base.html.twig' %}

{% block title %}Blog Index{% endblock %}

{% block body %}
<canvas id="gradient-canvas" style="width:100vw;height:100vh; opacity: 1; position: fixed; top: 0; left: 0; z-index: 0;"></canvas>
<script src="https://unpkg.com/detect-gpu@latest/dist/detect-gpu.umd.js"></script>
<script src="{{ asset('js/Gradient.js') }}"></script>
<script>
    async function detectGPU() {
        const gpuTier = await DetectGPU.getGPUTier()
        const hasGPUAcceleration = gpuTier.tier >= 2
        console.log("GPU Acceleration: " + hasGPUAcceleration);
        console.log("GPU Tier: " + gpuTier.tier);
        await processGPUResults(hasGPUAcceleration, gpuTier.tier)
    }

    async function processGPUResults(hasGPUAcceleration, gpuTier) {
        let gradientCanvas = document.getElementById('gradient-canvas')

        if (gpuTier === 0) {
            gradientCanvas.style.background = 'linear-gradient(318deg, rgba(96,146,236,1) 0%, rgba(56,103,156,1) 25%, rgba(36,36,56,1) 54%)';
        } else {
            new Gradient({
                canvas: '#gradient-canvas',
                colors: ['#1e202d', '#303f60', '#1e202d', '#1e202d'],
                static: gpuTier < 3,
            });
        }


        gradientCanvas.style.opacity = "1";

        await new Promise(resolve => setTimeout(resolve, 100));

        if (hasGPUAcceleration) {
            let shouldBlurElements = document.getElementsByClassName("element-item-container");
            for (let i = 0; i < shouldBlurElements.length; i++) {
                shouldBlurElements[i].style.backdropFilter = "blur(10px)";
            }

            let navbar = document.getElementById("taunahi-nav");
            if (navbar) {
                navbar.style.backdropFilter = "blur(10px)";
            }
        }

        for (const funcName of Object.getOwnPropertyNames(this)) {
            if (typeof this[funcName] === 'function' && funcName.startsWith("afterGpuCheck")) {
                const fn = window[funcName];
                fn(hasGPUAcceleration);
            }
        }
    }

    
    
        detectGPU();
    
</script>
<div class="container" style="margin-top: 60px;">
    <h1>Bienvenu(e) sur mon blog</h1>
    {% if app.user %}
        <p class="mb-3" style="margin-top: 10px;">
            Connecté sur {{ app.user.userIdentifier }}, <a href="{{ path('app_logout') }}">Déconnexion</a>
        </p>
    {% endif %}
    <div class="container-articles" style="margin-top: 75px;">
        {% for post in posts %}
            <div class="post">
                <h2>{{ post.titre }}</h2>
                <p>{{ post.contenu|slice(0, 100) }}...</p>
                <a href="{{ path('blog_detail', {'id': post.id}) }}">Lire cet article</a>
            </div>
        {% endfor %}
        
    </div>
    {% if app.user.userIdentifier == 'admin@symfony.com' %}
        <div style="display: flex; justify-content: center; width: 100%; margin-top: 40px; margin-bottom: 40px;">
            <div class="post" style="justify-content: center; width: fit-content;">
                <a href="/post" style="display: flex; text-align: center; justify-content: center;">Ajouter un article</a>
            </div>
        </div>
    {% endif %}
</div>
{% for message in app.flashes('success') %}
    <div class="center">
    <div class="check">
    <i class="far fa-check-circle color"></i> &nbsp; &nbsp;
    <span>{{message}}</span>
    </div>
    </div>
{% endfor %}
{% endblock %}

{% block stylesheets %}
<style>
    *,
    *:before,
    *:after {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    }
    .center {
        position: absolute;
        top: 5%;
        left: 50%;
        transform: translate(-50%,-50%);
    }

    h1{
        position: relative;
    }

    p{
        position: relative;
    }

    .check {
        border-radius: 5px;
        width: 220px;
        text-align: center;
        display: flex;
        align-items: center;
        padding: 10px;
        background-color: #2B3246;
        cursor:pointer;
        color: #0ad406;
        margin: 20px;
    }
    .check:hover{
        background-color: rgba(147, 209, 117, 0.50);
        transition:0.5s;
        }    body {
        background-color: #080710;
        font-family: 'Poppins', sans-serif;
        color: #ffffff;
        overflow-x: hidden;
    }
    .background {
        width: 100%;
        height: 300px;
        position: absolute;
        left: 0;
        top: 0;
        z-index: -1;
    }
    .container {
        width: 80%;
        margin: 0 auto;
        padding-top: 40px;
    }
    .container-articles {
        display: flex;
        flex-wrap: wrap;
        gap: 20px; /* Espacement entre les posts */
        justify-content: space-around; /* Répartit les éléments uniformément */
    }
    .post {
        background-color: rgba(255,255,255,0.13);
        padding: 20px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255,255,255,0.1);
        box-shadow: 0 0 20px rgba(8,7,16,0.6);
        width: calc(33.333% - 20px); /* Ajuste ce pourcentage selon le nombre d'articles par ligne souhaité */
        min-width: 250px; /* Largeur minimale pour chaque post */
    }
    .post h2, .post p, .post a {
        margin: 10px 0; /* Espacement entre les éléments du post */
    }
    .post h2 {
        font-size: 24px;
        font-weight: 500;
        color: #ffffff;
    }
    .post p {
        font-size: 16px;
        line-height: 1.5;
        color: #e5e5e5;
    }
    .post a {
        display: inline-block;
        background-color: #ffffff;
        color: #080710;
        padding: 10px 15px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 5px;
        text-decoration: none;
    }
</style>
{% endblock %}
